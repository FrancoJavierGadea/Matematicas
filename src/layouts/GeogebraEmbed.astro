---
const {
    title = '',
    id,
    width = 960,
    height = 540,
    borderColor = '#888888',
    borderRadius = 20,
    
    showFullScreenButton = false,
    showMenuBar = false,
    showToolBar = false,
    showToolBarHelp = false,
    showAlgebraInput = false,
    allowStyleBar = false,
    showResetIcon = false,
    enableRightClick = false,
    enableLabelDrags = false,
    enableShiftDragZoom = false,
    clickToLoad = false

} = Astro.props; 

/* const url = [
    'https://www.geogebra.org/material/iframe',
    `/id/${id}`,
    `/width/${width}`,
    `/height/${height}`,
    `/border/${border.replace('#', '')}`,
    `/sfsb/${showFullScreenButton}`,
    `/smb/${showMenuBar}`,
    `/stb/${showToolBar}`,
    `/stbh/${showToolBarHelp}`,
    `/ai/${showAlgebraInput}`,
    `/asb/${allowStyleBar}`,
    `/sri/${showResetIcon}`,
    `/rc/${enableRightClick}`,
    `/ld/${enableLabelDrags}`,
    `/sdz/${enableShiftDragZoom}`,
    `/ctl/${clickToLoad}`,
]
.join(''); */

---
<custom-geogebra title={title} width={width} height={height} id={id}

    showFullScreenButton={showFullScreenButton} 

    showMenuBar={showMenuBar} showAlgebraInput={showAlgebraInput} showToolBar={showToolBar}

    enableShiftDragZoom={enableShiftDragZoom} enableRightClick={enableRightClick} enableLabelDrags={enableLabelDrags}

    allowStyleBar={allowStyleBar}

    borderRadius={borderRadius} borderColor={borderColor}
>
    <!-- <iframe src={url} title={title} width={`${width}px`} height={`${height}px`} style="border: 0px;" allow="fullscreen" /> -->
</custom-geogebra>

<script>
    //@ts-nocheck
    import geogebraIframe from "@assets/geogebraIframe.html?raw";

    //https://wiki.geogebra.org/en/SetPerspective_Command
    const GEOGEBRA_PESPECTIVES = {
        'Algebra': 'A',
        'Graphics': 'G',
        'Graphics_2': 'D',
        'Probability_Calculator': 'B',
        'CAS': 'C',
        'Construction_Protocol': 'L',
        'Properties': 'P',
        'Spreadsheet': 'S',
        '3D_Graphics': 'T'
    }

    class CustomGeogebra extends HTMLElement {

        constructor(){
            super();

            const iframe = document.createElement('iframe');

            this.width = this.getAttribute('width');
            this.height = this.getAttribute('height'); 

            iframe.title = this.getAttribute('title');
            iframe.width = `${this.width}px`;
            iframe.height = `${this.height}px`;
            iframe.allowFullscreen = true;

            iframe.srcdoc = geogebraIframe;

            iframe.addEventListener('load', () => {

                console.log('load iframe');

                //Show: https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters
                const params = {
                    
                    "material_id": this.getAttribute('id'),
                    "width": this.width,
                    "height": this.height,

                    "showToolBar": this.hasAttribute('showToolBar'),
                    "showAlgebraInput": this.hasAttribute('showAlgebraInput'), 
                    "showMenuBar": this.hasAttribute('showMenuBar'),
                    "showZoomButtons": true,

                    "enableRightClick": this.hasAttribute('enableRightClick'),
                    "enableShiftDragZoom": this.hasAttribute('enableShiftDragZoom'),
                    "enableLabelDrags": this.hasAttribute('enableLabelDrags'),
                    "allowStyleBar": this.getAttribute('allowStyleBar'),

                    "borderColor": this.getAttribute('borderColor'),
                    "borderRadius": this.getAttribute('borderRadius'),

                    "language": 'es-ES',
                };

                iframe.contentWindow.createGeogebra(params, (api) => {

                    api.setPerspective(GEOGEBRA_PESPECTIVES.Graphics);
                });
            });

            this.appendChild(iframe);

            this.iframe = this.querySelector('iframe');
        }
    }

    customElements.define('custom-geogebra', CustomGeogebra);

</script>

<style
    define:vars={{
        'border-color': borderColor,
        'border-radius': `${borderRadius}px`
    }}
>

    custom-geogebra :global(iframe) {

        /* border: 1px solid var(--border-color); */
        border-radius: var(--border-radius);

        box-shadow: 0px 0px 10px 0px #00000039;
    }

</style>